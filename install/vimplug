!#/bin/sh

BASEDIR=$(dirname $0)
. $BASEDIR/inc/functions
dir=~/dotfiles


curl --version 2>&1 > /dev/null
if [ $? -ne 0 ]; then
  echo "Could not find curl."
  exit 1
fi

wget --version 2>&1 > /dev/null
if [ $? -ne 0 ]; then
  echo "Could not find wget"
  exit 1
fi


explain "Download latest nvim app"
cd /tmp
wget https://github.com/neovim/neovim/releases/download/nightly/nvim.appimage --output-document nvim
# wget http://gitreleases.dev/gh/neovim/neovim/v0.4.2/nvim.appimage --output-document nvim
chmod +x nvim
read -p "move nvim in /usr/bin [y/n]: " -n 1 -r
echo    # (optional) move to a new line
if [[ $REPLY =~ ^[Yy]$ ]]
then
  mv nvim $HOME/bin/
fi
cd -

explain "Download Vim-plug (Vim plugins manager)"
curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

if [ ! -e  ~/.vim/gutentags ]; then
  mkdir -p ~/.vim/gutentags
fi
if [ ! -e $HOME/.vim/spell ]; then
  explain "Spelling dictionary"
  mkdir -p ~/.vim/spell
  cd ~/.vim/spell
  wget http://ftp.vim.org/vim/runtime/spell/fr.latin1.spl
  wget http://ftp.vim.org/vim/runtime/spell/fr.latin1.sug
  wget http://ftp.vim.org/vim/runtime/spell/fr.utf-8.spl
  wget http://ftp.vim.org/vim/runtime/spell/fr.utf-8.sug
  wget http://ftp.vim.org/vim/runtime/spell/en.utf-8.sug
  wget http://ftp.vim.org/vim/runtime/spell/en.utf-8.spl
fi

explain "Vim plugins"
vim +PlugInstall +qa

tell ln -sf ~/.vimrc ~/.config/nvim/init.vim
tell cp -f --recursive --symbolic-link $dir/vim/* ~/.vim/

mkdir ~/.vim
mkdir ~/.config/nvim

explain "Symlink nvim to vim"
tell ln -sf ~/.vim/* ~/.config/nvim
tell ln -sf ~/.vimrc ~/.config/nvim/init.vim

mkdir -p ~/.vimundo
