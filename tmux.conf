set-option -sa terminal-overrides ",xterm*:Tc"
set -g escape-time 0
unbind-key C-b

set-option -g prefix C-Space
bind-key s split-window -h -c "#{pane_current_path}"
bind-key i split-window -v -c "#{pane_current_path}"
bind-key m set-window-option synchronize-panes
set -g status-interval 1

# Reload tmux.conf with prefix-r
bind C-t source-file ~/.tmux.conf \; display "Reloaded ~/.tmux.conf"

# setw -g mode-keys vi
# Bind escape to copy mode
unbind [
bind v copy-mode
bind-key k copy-mode \; send-keys -X cursor-up
bind-key K copy-mode \; send-keys -X cursor-up

# Start window numbering at 1 (default => 0)
set -g base-index 1

set-option -g allow-rename off

set -g focus-events on

# mouse
set-option -g mouse on

bind-key Space resize-pane -Z
bind-key / copy-mode \; command-prompt -p " Search up" "send -X search-backward \"%%%\""
bind-key  -T copy-mode-vi / command-prompt -p " Search up" "send -X search-backward \"%%%\""

# Search back to last prompt (mnemonic: "[b]ack"); searches for non-breaking
unbind b
bind-key b copy-mode\; send-keys -X start-of-line\; send-keys -X search-backward "❯"

# Smart pane switching with awareness of vim splits
# See this blog post for additional detail:
# http://robots.thoughtbot.com/post/53022241323/seamlessly-navigate-vim-and-tmux-splits
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iqE 'vim$' && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iqE 'vim$' && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iqE 'vim$' && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iqE 'vim$' && tmux send-keys C-l) || tmux select-pane -R"
bind -n C-\ run "(tmux display-message -p '#{pane_current_command}' | grep -iqE 'vim$' && tmux send-keys 'C-\\') || tmux select-pane -l"

# Alt-h: Previous window
bind -n M-h prev
bind -n M-H prev
# Alt-l: Next window
bind -n M-l next
bind -n M-L next
# Alt-n: New window
bind -n M-n new-window -c "#{pane_current_path}"

# Resize pane with arrows keys
unbind -n C-Left
unbind -n C-Down
unbind -n C-Up
unbind -n C-Right
bind -n C-Left resize-pane -L 10
bind -n C-Right resize-pane -R 10
bind -n C-Down resize-pane -D 5
bind -n C-Up resize-pane -U 5

bind-key c new-window -c "#{pane_current_path}"
bind-key D detach-client -a

set -g set-titles on
set-option -g pane-border-bg colour0
set-option -g pane-border-fg colour238
set-option -g pane-active-border-bg colour0
set-option -g pane-active-border-fg colour166

# set-option -g message-bg colour235
# set-option -g message-command-bg colour235

set-option -g message-bg colour18
set-option -g message-command-bg colour228

set-option -g message-command-fg colour7
set-option -g visual-activity off

#set inactive/active window styles
set-option -g status on                # turn the status bar on
set-option -g history-limit 30000
set -g status-justify left
setw -g window-status-separator ""

# set -g status-bg colour235
set -g status-bg colour18

set-window-option -g window-status-format "#[fg=colour7] #I #W "
set-window-option -g window-status-current-format "#[fg=colour18, bg=colour124] #I #W "

set -g message-fg "white"

set -g status-left-length 80
set -g status-left " #[fg=colour3]#S "
set -g status-right-length 80
set -g status-right " #[fg=yellow,bg=default,bright]#(tmux-mem-cpu-load --interval 2 -a 0 -t 2 -m 0)#[default] #[fg=colour246, bg=colour18]#[fg=colour235, bg=colour246] %H:%M:%S "
setw -g xterm-keys on

# Scroll 3 lines at a time instead of default 5; don't extend dragged selections.
bind-key -T copy-mode-vi WheelUpPane select-pane\; send-keys -t{mouse} -X clear-selection\; send-keys -t{mouse} -X -N 3 scroll-up
bind-key -T copy-mode-vi WheelDownPane select-pane\; send-keys -t{mouse} -X clear-selection\; send-keys -t{mouse} -X -N 3 scroll-down

# Stay in copy mode on drag end.
# (Would use `bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X
# stop-selection` but it is a bit glitchy.)
unbind-key -T copy-mode-vi MouseDragEnd1Pane

# Use v to trigger selection
bind-key -T copy-mode-vi v send-keys -X begin-selection

# Use y to yank current selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe "xclip -in -selection clipboard" \; \
  send -X copy-selection-and-cancel

# Use Y to yank current command (omit the start)
bind-key -T copy-mode-vi Y send-keys -X clear-selection \; send-keys -X start-of-line \; \
  send-keys -X cursor-right \; send-keys -X cursor-right \; send-keys -X begin-selection \; \
  send-keys -X end-of-line \; send-keys -X cursor-left

bind-key -T copy-mode-vi H send-keys -X start-of-line
bind-key -T copy-mode-vi L send-keys -X end-of-line

# Don't wrap searches; it's super confusing given tmux's reverse-ordering of
# position info in copy mode.
set -w -g wrap-search off

bind \; command-prompt

# save to clipboard on Enter
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe "xclip -in -selection clipboard" \; send -X copy-selection-and-cancel

run-shell ~/.tmux-resurrect/resurrect.tmux
set -g @resurrect-processes 'ssh psql mysql "~./redis-server->./redis-server" "~./redis-cli" "~./manage.py runserver->cd . && ./manage.py runserver" "~http-server-> http-server"'

